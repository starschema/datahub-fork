# Governance Rules Configuration
# Simplified rules matching Acryl Cloud DataHub capabilities
# Using the 4 core check types: ownership, description, glossary terms, tags

rules:
  # ============================================================================
  # PRODUCTION GOVERNANCE
  # ============================================================================

  # Rule 1: Production Dataset Governance
  # All production datasets must have owners and documentation
  - name: production_dataset_governance
    enabled: true

    scope:
      entity_types: [DATASET]
      envs: [PROD]

    checks:
      - type: requires_owner
        params:
          min_owners: 1

      - type: requires_description
        params:
          min_length: 20

    emit_test_results: true
    create_incident_on_fail: false

  # Rule 2: Snowflake Production Governance
  # Platform-specific governance for Snowflake
  - name: snowflake_production_governance
    enabled: true

    scope:
      entity_types: [DATASET]
      platforms: [snowflake]
      envs: [PROD]

    checks:
      - type: requires_owner
        params:
          min_owners: 1

      - type: requires_description
        params:
          min_length: 10

    emit_test_results: true
    create_incident_on_fail: false

  # ============================================================================
  # CRITICAL DATA GOVERNANCE
  # ============================================================================

  # Rule 3: Tier 1 Data Governance
  # Critical datasets need enhanced governance
  - name: tier1_governance
    enabled: false  # Enable when tier-1 tagging is ready

    scope:
      entity_types: [DATASET]
      envs: [PROD]
      tags_any:
        - "urn:li:tag:tier:1"
        - "urn:li:tag:Tier1"
        - "urn:li:tag:Critical"

    checks:
      - type: requires_owner
        params:
          min_owners: 2
          allowed_types:
            - DATAOWNER
            - TECHNICAL_OWNER

      - type: requires_description
        params:
          min_length: 50

      - type: requires_glossary_term
        params:
          any_of:
            - "urn:li:glossaryTerm:Classification.PII"
            - "urn:li:glossaryTerm:Classification.Sensitive"
            - "urn:li:glossaryTerm:Classification.Financial"
            - "urn:li:glossaryTerm:Classification.Public"

    emit_test_results: true
    create_incident_on_fail: true

    incident_config:
      priority: HIGH
      custom_type: "TIER1_GOVERNANCE_VIOLATION"

  # ============================================================================
  # COMPLIANCE GOVERNANCE
  # ============================================================================

  # Rule 4: PII Data Governance
  # Datasets with PII must have proper classification
  - name: pii_data_governance
    enabled: false  # Enable when PII tagging is ready

    scope:
      entity_types: [DATASET]
      tags_any:
        - "urn:li:tag:PII"
        - "urn:li:tag:PersonalData"

    checks:
      - type: requires_owner
        params:
          min_owners: 1
          allowed_types:
            - DATAOWNER

      - type: requires_description
        params:
          min_length: 30

      - type: requires_glossary_term
        params:
          any_of:
            - "urn:li:glossaryTerm:Classification.PII"

      - type: requires_tag
        params:
          any_of:
            - "urn:li:tag:GDPR"
            - "urn:li:tag:CCPA"
            - "urn:li:tag:ComplianceReviewed"

    emit_test_results: true
    create_incident_on_fail: true

    incident_config:
      priority: CRITICAL
      custom_type: "PII_GOVERNANCE_VIOLATION"

  # ============================================================================
  # BI & ANALYTICS GOVERNANCE
  # ============================================================================

  # Rule 5: Dashboard Governance
  # Dashboards must have owners and descriptions
  - name: dashboard_governance
    enabled: true

    scope:
      entity_types: [DASHBOARD]
      platforms: [looker, tableau, superset, powerbi, mode]

    checks:
      - type: requires_owner
        params:
          min_owners: 1

      - type: requires_description
        params:
          min_length: 20

    emit_test_results: true
    create_incident_on_fail: false
