# Ingestion Source Mapper Action Configuration
# This action maintains a durable {dataset -> ingestion source URN} mapping
# by tracking which pipeline/connector ingested each dataset

name: "ingestion_source_mapper"

source:
  type: "kafka"
  config:
    connection:
      bootstrap: "broker:29092"
      schema_registry_url: "http://schema-registry:8081"
    topic_routes:
      mcl: "MetadataChangeLog_Versioned_v1"
      pe: "PlatformEvent_v1"

filter:
  event_type: "MetadataChangeLogEvent_v1"
  event:
    entityType: "dataset"
    # Listen to all dataset aspects to capture ingestion source
    # The action will extract pipelineName from system metadata

action:
  type: "ingestion_source_mapper"
  config:
    enabled: true
    property_key: "datahub.ingestion.sourceUrn"

datahub:
  server: "http://datahub-gms:8080"
  # Authentication handled automatically via DATAHUB_SYSTEM_CLIENT_ID and DATAHUB_SYSTEM_CLIENT_SECRET env vars
