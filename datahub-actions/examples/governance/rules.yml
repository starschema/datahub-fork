# Governance Rules Configuration
# This file defines governance rules that are evaluated against DataHub entities
# in real-time as metadata changes occur.

rules:
  # Rule 1: Tier 1 Data Governance
  # Ensures production datasets with tier:1 tag meet strict governance standards
  - name: tier1_governance
    enabled: true

    # Scope: Which entities does this rule apply to?
    scope:
      entity_types: [DATASET]
      platforms: [snowflake, bigquery]
      envs: [PROD]
      tags_any:
        - "urn:li:tag:tier:1"
        - "urn:li:tag:Tier1"

    # Checks: What requirements must be met?
    checks:
      # Require at least 2 owners (DATAOWNER or TECHNICAL_OWNER)
      - type: requires_owner
        params:
          min_owners: 2
          allowed_types:
            - DATAOWNER
            - TECHNICAL_OWNER

      # Require meaningful description (at least 50 characters)
      - type: requires_description
        params:
          min_length: 50

      # Require PII or Financial classification term
      - type: requires_glossary_term
        params:
          any_of:
            - "urn:li:glossaryTerm:Classification.PII"
            - "urn:li:glossaryTerm:Classification.Financial"

    # Output: What happens when checks fail?
    emit_test_results: true  # Show in Governance tab
    create_incident_on_fail: true  # Create trackable incident

    incident_config:
      priority: HIGH
      custom_type: "GOVERNANCE_VIOLATION"
      assignees:
        - "urn:li:corpGroup:data-governance-team"

  # Rule 2: Basic Dataset Governance
  # Lighter requirements for all production datasets
  - name: basic_dataset_governance
    enabled: true

    scope:
      entity_types: [DATASET]
      envs: [PROD]

    checks:
      # At least one owner required
      - type: requires_owner
        params:
          min_owners: 1

      # Description required (any length)
      - type: requires_description
        params:
          min_length: 1

    emit_test_results: true
    create_incident_on_fail: false  # Report only, no incidents

  # Rule 3: PII Data Governance
  # Special requirements for datasets tagged with PII
  - name: pii_data_governance
    enabled: true

    scope:
      entity_types: [DATASET]
      tags_any:
        - "urn:li:tag:PII"
        - "urn:li:tag:PersonalData"

    checks:
      # Require data owner for PII datasets
      - type: requires_owner
        params:
          min_owners: 1
          allowed_types: [DATAOWNER]

      # Require PII classification term
      - type: requires_glossary_term
        params:
          any_of:
            - "urn:li:glossaryTerm:Classification.PII"

      # Require compliance tags
      - type: requires_tag
        params:
          any_of:
            - "urn:li:tag:GDPR"
            - "urn:li:tag:CCPA"

    emit_test_results: true
    create_incident_on_fail: true

    incident_config:
      priority: CRITICAL
      custom_type: "PII_GOVERNANCE_VIOLATION"
      assignees:
        - "urn:li:corpGroup:privacy-team"
        - "urn:li:corpGroup:data-governance-team"

  # Rule 4: Dashboard Governance
  # Ensure dashboards have proper ownership and documentation
  - name: dashboard_governance
    enabled: true

    scope:
      entity_types: [DASHBOARD]
      platforms: [looker, tableau, superset]

    checks:
      - type: requires_owner
        params:
          min_owners: 1

      - type: requires_description
        params:
          min_length: 20

    emit_test_results: true
    create_incident_on_fail: false

  # Rule 5: Data Quality Tagged Datasets
  # Datasets marked for quality monitoring need glossary terms
  - name: data_quality_governance
    enabled: true

    scope:
      entity_types: [DATASET]
      tags_any:
        - "urn:li:tag:DataQuality"

    checks:
      - type: requires_glossary_term
        params:
          any_of:
            - "urn:li:glossaryTerm:DataQuality.Validated"
            - "urn:li:glossaryTerm:DataQuality.MonitoringEnabled"

    emit_test_results: true
    create_incident_on_fail: false
